(()=>{var H=Object.defineProperty;var l=(C,f)=>H(C,"name",{value:f,configurable:!0});(window.webpackJsonp=window.webpackJsonp||[]).push([["gantry-v2-async-client-boot-apis"],{CTVb:function(C,f,t){"use strict";t.r(f),t.d(f,"register",function(){return $}),t.d(f,"test",function(){return W});var r=t("9oTK"),p=t("ifKl"),m=t("Lgge"),b=t("Xm7Q"),O=t("s4P+"),v=t("cznn"),d=t("Ki/W"),h=t("FUHi"),D=t("Pu1M"),T=t("H1iM"),g=t("mzcH"),_=t("qbW+"),B=t("x0KC"),y=t("ycWl"),U=t("31wZ"),L=t("KGIc"),F=t("mard");function x(n){return I.apply(this,arguments)}l(x,"maybeReloadForMinVersionBump");function I(){return I=Object(r.coroutine)(function*(n){let{clientBootData:a}=n;const{should_reload:e,client_min_version:i}=a,u=Object(L.d)();if(parseInt(u??"0",10)&&e){if(Object(U.a)(i))return Object(y.a)({reason:"Reloading due to a min version bump (client.boot)",reasonKey:"min_version_bump_client_boot"}),Object(F.a)();throw new Error("Unable to reload for min version bump at boot")}}),I.apply(this,arguments)}l(I,"_maybeReloadForMinVersionBump");function M(n){return E.apply(this,arguments)}l(M,"transformInitialApiResponses");function E(){return E=Object(r.coroutine)(function*(n){let{apiCalls:a,contextualInfo:e}=n;const{clientBootData:i,viewData:u,...s}=a,c=a.clientBootData.then(d.a);c.catch(p.a);const o=a.viewData.then(h.a);return o.catch(p.a),{apiCalls:{clientBootData:c,viewData:o,...s},contextualInfo:e}}),E.apply(this,arguments)}l(E,"_transformInitialApiResponses");function V(n){return A.apply(this,arguments)}l(V,"setConfigVersions");function A(){return A=Object(r.coroutine)(function*(n){let{apiCalls:a,contextualInfo:e}=n;const{teamId:i}=e;if(!i)return{apiCalls:a,contextualInfo:e};const{featureFlagData:u,experimentData:s}=a;return m.a.all([u,s]).then(c=>{let[o,j]=c;const{config_version_ts:K}=o,{config_version_ts:z}=j;Object(D.a)({featureFlagConfigVersionTs:K,experimentsConfigVersionTs:z,teamId:i})},()=>{}).catch(c=>{Object(O.b)().error("BOOT",`Failed to store config version: ${c}`)}),{apiCalls:a,contextualInfo:e}}),A.apply(this,arguments)}l(A,"_setConfigVersions");function S(n){return P.apply(this,arguments)}l(S,"startOnboardingApis");function P(){return P=Object(r.coroutine)(function*(n){let{apiCalls:a,contextualInfo:e}=n;const{getTracer:i,getTrace:u}=e.getTraceMeta(),s=u(),c=m.a.all([a.clientBootData,a.featureFlagData]).then(o=>{let[j,K]=o;return i().traceFn({name:"fetchOnboardingData",options:{traceId:s.getTraceId(),parentSpanId:s.getRootSpanId()}},T.a.bind(null,{apiData:{clientBootData:j,featureFlagData:K},contextualInfo:e}))}).catch(o=>{throw o.type=b.a.API,o.subType="allOnboardingData",o});return c.catch(p.a),{apiCalls:{allOnboardingData:c,...a},contextualInfo:e}}),P.apply(this,arguments)}l(P,"_startOnboardingApis");function Q(n){return R.apply(this,arguments)}l(Q,"maybeMergeChannelData");function R(){return R=Object(r.coroutine)(function*(n){let{apiCalls:a,contextualInfo:e}=n;const i=m.a.all([a.clientBootData,a.viewData]).then(u=>{let[s,c]=u;return{...s,channelsData:Object(g.a)({viewData:c,channelsData:s.channelsData})}});return i.catch(p.a),{apiCalls:{...a,clientBootData:i},contextualInfo:e}}),R.apply(this,arguments)}l(R,"_maybeMergeChannelData");function $(n){n.hooks.apiAfterInitialCalls.tap("Transform initial API responses",M),n.hooks.apiAfterInitialCalls.tap("Maybe reload for a min version bump based on the client.boot response",function(){var a=Object(r.coroutine)(function*(e){let{apiCalls:i,contextualInfo:u}=e;const s=i.clientBootData.then(function(){var c=Object(r.coroutine)(function*(o){return yield x({clientBootData:o}),o});return function(o){return c.apply(this,arguments)}}());return s.catch(p.a),{apiCalls:{...i,clientBootData:s},contextualInfo:u}});return function(e){return a.apply(this,arguments)}}()),n.hooks.apiAfterInitialCalls.tap("Store config versions",V),n.hooks.apiAfterInitialCalls.tap("Start onboarding APIs",S),n.hooks.apiAfterInitialCalls.tap("Merge view data with client.boot channels data",Q),n.hooks.apiAfterInitialCalls.tap("Close API Boot Queue",v.a),n.hooks.apiAfterInitialCalls.tap("Maybe re-auth based on the client.boot response",function(){var a=Object(r.coroutine)(function*(e){let{apiCalls:i,contextualInfo:u}=e;const s=i.clientBootData.then(function(){var c=Object(r.coroutine)(function*(o){return yield Object(_.a)({clientBootData:o}),o});return function(o){return c.apply(this,arguments)}}());return s.catch(p.a),{apiCalls:{...i,clientBootData:s},contextualInfo:u}});return function(e){return a.apply(this,arguments)}}()),n.hooks.apiAfterInitialCalls.tap("Maybe redirect to the terms of service based on the client.boot response",function(){var a=Object(r.coroutine)(function*(e){let{apiCalls:i,contextualInfo:u}=e;const s=i.clientBootData.then(function(){var c=Object(r.coroutine)(function*(o){return yield Object(B.a)({clientBootData:o}),o});return function(o){return c.apply(this,arguments)}}());return s.catch(p.a),{apiCalls:{...i,clientBootData:s},contextualInfo:u}});return function(e){return a.apply(this,arguments)}}())}l($,"register");const W={};Object.defineProperty(W,"transformInitialApiResponses",{get:()=>M,set:n=>{M=n}})},cznn:function(C,f,t){"use strict";t.d(f,"a",function(){return b});var r=t("9oTK"),p=t.n(r),m=t("Lgge");function b(v){return O.apply(this,arguments)}l(b,"apiCloseBootQueue");function O(){return O=Object(r.coroutine)(function*(v){let{apiCalls:d,contextualInfo:h}=v;return m.a.all(Object.values(d)).catch(()=>{}).finally(()=>{h.bootQueue.stop()}),{apiCalls:d,contextualInfo:h}}),O.apply(this,arguments)}l(O,"_apiCloseBootQueue")},"qbW+":function(C,f,t){"use strict";t.d(f,"a",function(){return v});var r=t("9oTK"),p=t.n(r),m=t("Omjo"),b=t("mard"),O=t("60mp");function v(h){return d.apply(this,arguments)}l(v,"maybeReloadForReAuth");function d(){return d=Object(r.coroutine)(function*(h){let{clientBootData:D}=h;if(!(D==null?void 0:D.should_reauth))return;Object(m.b)("BOOT","Detected need to reauth; fetching auth and halting current boot.");const g=!1,_=!1,B=[],y=!0;return Object(O.d)(g,_,B,y),Object(b.a)()}),d.apply(this,arguments)}l(d,"_maybeReloadForReAuth")},x0KC:function(C,f,t){"use strict";t.d(f,"a",function(){return d});var r=t("9oTK"),p=t.n(r),m=t("Omjo"),b=t("mard"),O=t("wwBm"),v=t("qiCS");function d(D){return h.apply(this,arguments)}l(d,"maybeRedirectToTermsOfService");function h(){return h=Object(r.coroutine)(function*(D){let{clientBootData:T}=D;const g=T.acceptTosUrl;if(!g)return;const _=Object(O.f)(location.search,"force_cold_boot",1),B=`/gantry${location.pathname}${_}`,y=Object(v.d)(g,"redirect",B);return Object(m.b)("BOOT",`(${T.teamData.id}) User needs to accept the terms of service; redirecting to ${y}`),location.assign(y),Object(b.a)()}),h.apply(this,arguments)}l(h,"_maybeRedirectToTermsOfService")}}]);})();
